---
title: Consejos Avanzados
---

import { Callout } from 'nextra/components'
import RalphAccessGate from '../../components/RalphAccessGate'

# Lecci√≥n 3.8: Consejos Avanzados

<RalphAccessGate>

## Llevando Ralph al Siguiente Nivel

Ya dominas los fundamentos. Ahora veamos t√©cnicas avanzadas para proyectos m√°s complejos y entornos de producci√≥n.

---

## 1. Seguridad con Docker

<Callout type="warning">
  Ejecutar c√≥digo aut√≥nomo es inherentemente riesgoso. Docker a√±ade una capa de protecci√≥n.
</Callout>

### Dockerfile para Ralph

```dockerfile
# Dockerfile.ralph
FROM node:20-slim

# Crear usuario no-root
RUN useradd -m -s /bin/bash ralph

# Directorio de trabajo
WORKDIR /project

# Copiar archivos del proyecto
COPY --chown=ralph:ralph . .

# Cambiar a usuario ralph
USER ralph

# Instalar Claude Code globalmente para el usuario
RUN npm install -g @anthropic-ai/claude-code

# Entry point
CMD ["./loop.sh"]
```

### docker-compose.yml

```yaml
version: '3.8'
services:
  ralph:
    build:
      context: .
      dockerfile: Dockerfile.ralph
    volumes:
      # Solo montar lo necesario (read-only excepto src/)
      - ./src:/project/src
      - ./PLAN.md:/project/PLAN.md
      - ./PROGRESS.md:/project/PROGRESS.md
      - ./PROMPT_build.md:/project/PROMPT_build.md:ro
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    # Limitar recursos
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
```

### Ejecutar

```bash
docker-compose up ralph
```

### Beneficios

- **Aislamiento**: Ralph no puede tocar nada fuera del contenedor
- **Reproducibilidad**: El mismo entorno siempre
- **L√≠mites de recursos**: No puede consumir toda tu CPU/RAM
- **Sin permisos root**: Minimiza da√±os potenciales

---

## 2. M√∫ltiples Agentes

Para proyectos grandes, puedes tener m√∫ltiples "Ralphs" trabajando en paralelo.

### Estructura

```
mi-proyecto/
‚îú‚îÄ‚îÄ ralph-backend/
‚îÇ   ‚îú‚îÄ‚îÄ loop.sh
‚îÇ   ‚îú‚îÄ‚îÄ PROMPT_build.md      # Solo backend
‚îÇ   ‚îú‚îÄ‚îÄ PLAN.md
‚îÇ   ‚îî‚îÄ‚îÄ PROGRESS.md
‚îú‚îÄ‚îÄ ralph-frontend/
‚îÇ   ‚îú‚îÄ‚îÄ loop.sh
‚îÇ   ‚îú‚îÄ‚îÄ PROMPT_build.md      # Solo frontend
‚îÇ   ‚îú‚îÄ‚îÄ PLAN.md
‚îÇ   ‚îî‚îÄ‚îÄ PROGRESS.md
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ backend/
    ‚îî‚îÄ‚îÄ frontend/
```

### Coordinaci√≥n

Crea un archivo compartido `SHARED_PROGRESS.md`:

```markdown
# SHARED_PROGRESS.md

## API Contracts (backend ‚Üí frontend)
- POST /api/users: { email, password } ‚Üí { token }
- GET /api/notes: ‚Üí [{ id, title, content }]

## Decisiones Globales
- Puerto backend: 3001
- Puerto frontend: 3000
- Formato de fechas: ISO 8601
```

A√±ade a cada PROMPT_build.md:

```markdown
## Coordinaci√≥n
Antes de empezar, lee SHARED_PROGRESS.md para contratos de API.
Si haces cambios que afectan al otro agente, actualiza SHARED_PROGRESS.md.
```

---

## 3. Checkpoints y Recuperaci√≥n

### Git Autom√°tico

A√±ade commits autom√°ticos a loop.sh:

```bash
#!/bin/bash

ITERATION=1

while true; do
    echo "üîÑ Iteraci√≥n #$ITERATION"

    # Ejecutar Claude
    claude -p "$(cat PROMPT_build.md)"

    # Checkpoint autom√°tico con git
    if [[ $(git status --porcelain) ]]; then
        git add -A
        git commit -m "Ralph: Iteraci√≥n #$ITERATION - $(date +%H:%M)"
        echo "üì∏ Checkpoint guardado"
    fi

    ITERATION=$((ITERATION + 1))
    sleep 10
done
```

### Rollback F√°cil

Si algo sale mal:

```bash
# Ver historial de Ralph
git log --oneline | grep "Ralph:"

# Rollback a iteraci√≥n espec√≠fica
git revert HEAD~3..HEAD
```

---

## 4. M√©tricas y An√°lisis

### Script de An√°lisis

```bash
#!/bin/bash
# analyze_ralph.sh

echo "üìä An√°lisis de Sesi√≥n Ralph"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"

# Duraci√≥n total
START=$(head -5 ralph_log_*.txt | grep "Inicio:" | tail -1)
echo "Inicio: $START"

# Iteraciones
ITERATIONS=$(grep -c "Iteraci√≥n #" ralph_log_*.txt)
echo "Iteraciones: $ITERATIONS"

# Tareas completadas
COMPLETED=$(grep -c "\[x\]" PLAN.md)
TOTAL=$(grep -c "\[.\]" PLAN.md)
echo "Tareas: $COMPLETED/$TOTAL completadas"

# Errores detectados
ERRORS=$(grep -ci "error\|failed\|exception" ralph_log_*.txt)
echo "Errores detectados: $ERRORS"

# Archivos modificados
FILES=$(git diff --stat HEAD~$ITERATIONS --name-only 2>/dev/null | wc -l)
echo "Archivos modificados: $FILES"
```

### Dashboard Simple

```bash
# Ejecutar en loop mientras Ralph trabaja
watch -n 30 ./analyze_ralph.sh
```

---

## 5. Specs Avanzadas

### Templates por Tipo de Proyecto

**Para APIs:**
```markdown
## Endpoints
[tabla de endpoints con m√©todo, ruta, body, respuesta]

## Autenticaci√≥n
[tipo de auth, flujo, tokens]

## Validaci√≥n
[reglas de validaci√≥n por campo]
```

**Para Frontends:**
```markdown
## Componentes
[√°rbol de componentes]

## Estado
[estructura del state management]

## Rutas
[lista de rutas y componentes]
```

**Para CLIs:**
```markdown
## Comandos
[lista de comandos con flags]

## Flujos
[secuencia de operaciones]

## Configuraci√≥n
[archivos de config soportados]
```

---

## 6. Patrones de Recuperaci√≥n

### Auto-Diagn√≥stico

A√±ade al final de PROMPT_build.md:

```markdown
## Si Algo Falla
1. Documenta el error exacto en PROGRESS.md
2. Intenta una soluci√≥n
3. Si falla 2 veces: marca tarea como bloqueada
4. Pasa a la siguiente tarea
5. NO te quedes en loop infinito en un error
```

### Tareas de Emergencia

```markdown
## üö® En Caso de Muchos Errores
Si hay m√°s de 3 tareas bloqueadas:
1. Ejecuta `npm test` y documenta resultados
2. Ejecuta `npm run lint` y documenta errores
3. Crea una secci√≥n "## Diagn√≥stico" en PROGRESS.md
4. Lista todos los problemas encontrados
5. Termina la sesi√≥n (no intentes arreglar)
```

---

## 7. Integraci√≥n Continua

### GitHub Actions con Ralph

```yaml
# .github/workflows/ralph.yml
name: Ralph Nightly Build

on:
  schedule:
    - cron: '0 2 * * *'  # 2 AM cada d√≠a
  workflow_dispatch:     # Manual trigger

jobs:
  ralph:
    runs-on: ubuntu-latest
    timeout-minutes: 180  # 3 horas m√°ximo

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install Claude Code
        run: npm install -g @anthropic-ai/claude-code

      - name: Run Ralph (max 10 iterations)
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          for i in {1..10}; do
            echo "Iteration $i"
            claude -p "$(cat PROMPT_build.md)" || true
            sleep 5
          done

      - name: Commit Changes
        run: |
          git config user.name "Ralph Bot"
          git config user.email "ralph@bot.local"
          git add -A
          git commit -m "Ralph: Nightly build $(date +%Y-%m-%d)" || true
          git push
```

---

## 8. Costos y Optimizaci√≥n

### Estimaci√≥n de Costos

| Iteraciones | Tokens aprox. | Costo (Claude Sonnet) |
|-------------|---------------|----------------------|
| 10 | ~500k | ~$1.50 |
| 50 | ~2.5M | ~$7.50 |
| 100 | ~5M | ~$15.00 |

### Reducir Costos

1. **Tareas m√°s at√≥micas** = menos contexto por iteraci√≥n
2. **PROGRESS.md conciso** = menos tokens le√≠dos
3. **Modelo m√°s econ√≥mico** para tareas simples

---

## Conclusi√≥n del M√≥dulo

<div className="my-8 p-6 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-white">
  <h3 className="text-2xl font-bold mb-4">üéâ ¬°Has Completado Ralph Loop!</h3>
  <p className="mb-4">
    Ahora tienes las herramientas para poner a Claude en piloto autom√°tico.
    √ösalas con responsabilidad.
  </p>
  <ul className="space-y-2">
    <li>‚úÖ Entiendes Context Rot y c√≥mo superarlo</li>
    <li>‚úÖ Dominas los 4 archivos del sistema</li>
    <li>‚úÖ Puedes escribir specs efectivas</li>
    <li>‚úÖ Sabes crear planes at√≥micos</li>
    <li>‚úÖ Puedes monitorear e intervenir</li>
    <li>‚úÖ Conoces t√©cnicas avanzadas de seguridad</li>
  </ul>
</div>

### Siguiente Paso Recomendado

Aplica Ralph a un proyecto real:
1. Elige un proyecto peque√±o (MVP, utilidad, migraci√≥n)
2. Escribe specs detalladas (30+ minutos)
3. Crea un plan de 15-20 tareas at√≥micas
4. Lanza Ralph y observa
5. Itera y mejora tus specs

<Callout type="info">
  ¬øQuieres ir m√°s all√°? El **Course Builder** te ense√±a a crear cursos completos con IA,
  incluyendo contenido, ejercicios y evaluaciones automatizadas.
</Callout>

</RalphAccessGate>
